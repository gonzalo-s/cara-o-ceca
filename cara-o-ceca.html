<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Cara o Ceca</title>
	</head>
	<style>
		#flipButton {
			background-color: brown;
		}
		#finalResultView {
			display: none;
		}
	</style>
	<body>
		<h1>Cara o Ceca</h1>
		<form>
			<ul>
				<li class="option">
					<input type="radio" id="cara" name="lado" value="cara" />
					<label for="cara">Cara</label>
				</li>
				<li class="option">
					<input type="radio" id="ceca" name="lado" value="ceca" />
					<label for="ceca">Ceca</label>
				</li>
			</ul>
			<button id="flipButton" type="submit">
				Flip
			</button>
		</form>
		<div>Intentos: <span id="flipCountDisplay"></span></div>
		<div>Moneda: <span id="flipSide"></span></div>
		<div id="errorMessage">error:</div>
		<div id="partialResult"></div>
		<div id="finalResultView">Ganador: <span id="finalResult"></span></div>
		<button id="resetButton">RESET</button>
		<button id="resetHistoryButton">RESET HISTORY</button>

		<script>
			// guardar una referencia al formulario en una variable form
			const options = ['cara', 'ceca']
			let gameHistory = []
			const form = document.querySelector('form')
			const flipCountDisplay = document.querySelector('#flipCountDisplay')
			const flipSide = document.querySelector('#flipSide')
			const errorMessage = document.querySelector('#errorMessage')
			const partialResult = document.querySelector('#partialResult')
			const finalResult = document.querySelector('#finalResult')
			const finalResultView = document.querySelector('#finalResultView')
			const buttonDisabled = form.querySelector('#flipButton')
			let resetButton = document.querySelector('#resetButton')
			let resetHistoryButton = document.querySelector(
				'#resetHistoryButton'
			)
			let historialResult = [
				{ name: 'human', wins: 0 },
				{ name: 'machine', wins: 0 },
			]
			let winner = ''

			buttonDisabled.disabled = true

			let flipCount = 0
			flipCountDisplay.textContent = flipCount
			errorMessage.textContent = 'seleccionar cara o ceca'

			resetForm()
			function resetForm() {
				form.cara.checked = false
				form.ceca.checked = false
			}
			function resetHistorialResult() {
				historialResult[0].wins = 0
				historialResult[1].wins = 0
			}
			if (getSelectedLado()) {
				partialResult.textContent = ''
			}

			//extraer lado seleccionado de form con formdata
			function getSelectedLado() {
				const data = new FormData(form)
				for (const entry of data) {
					if (entry[0] === 'lado') {
						return entry[1]
					}
				}
				return null
			}

			function getRandomInt(min, max) {
				min = Math.ceil(min)
				max = Math.floor(max)
				return Math.floor(Math.random() * (max - min)) + min //The maximum is exclusive and the minimum is inclusive
			}

			resetButton.addEventListener('click', () => {
				//resetear todo para volver a empezar
				flipCount = 0
				winner = ''
				resetHistorialResult()
				buttonDisabled.disabled = false
				flipCountDisplay.textContent = flipCount
				partialResult.textContent = ''
				finalResult.textContent = ''
				flipSide.textContent = ''
				resetForm()
				finalResultView.style.display = ''
				errorMessage.textContent = 'seleccionar cara o ceca'
			})

			resetHistoryButton.addEventListener('click', () => {
				if (gameHistory !== []) {
					return (gameHistory = ['']), console.log(gameHistory)
				}
				return gameHistory
			})

			form.addEventListener('change', () => {
				if (getSelectedLado()) {
					errorMessage.textContent = ''
					buttonDisabled.disabled = false
					// si cambia de opcion cara o ceca resetear intentos SOLO si ya hay un ganador
					if (winner) {
						flipCount = 0
						resetHistorialResult()
						flipCountDisplay.textContent = flipCount
					}
					console.log(winner)
				}
			})

			form.addEventListener('submit', (event) => {
				event.preventDefault()

				errorMessage.textContent = ''

				let userLado = getSelectedLado()

				if (userLado === null) {
					errorMessage.textContent = 'seleccionar cara o ceca'
					return
				}
				const machineLadoIdx = getRandomInt(0, options.length)
				const machineLado = options[machineLadoIdx]
				flipSide.textContent = machineLado
				//console.log({ userLado, machineLado })
				//calculo del resultado del partial match
				if (machineLado === userLado) {
					partialResult.textContent = 'Ganaste'
					historialResult[0].wins = historialResult[0].wins + 1
				} else {
					partialResult.textContent = 'Perdiste'
					historialResult[1].wins = historialResult[1].wins + 1
				}
				flipCount = historialResult[0].wins + historialResult[1].wins
				flipCountDisplay.textContent = flipCount

				//ver quien es el ganador FINAL, 2 ganados

				if (
					historialResult[0].wins === 2 ||
					historialResult[1].wins === 2
				) {
					flipCountDisplay.textContent = flipCount
					// ver quien es el winner, la maquina o el humano y seguir
					// TODO: map vs foreach
					historialResult.map((player) => {
						if (player.wins === 2) {
							winner = player.name
						}
					})
					console.log(
						'historialResult ',
						JSON.parse(JSON.stringify(historialResult))
					)

					gameHistory.push(
						JSON.parse(JSON.stringify(historialResult))
					)

					console.log('gameHistory ', gameHistory)

					finalResult.textContent = winner
					buttonDisabled.disabled = true
					finalResultView.style.display = 'block'

					//(ok)  ver logica de mejor de 3, 2 ganados seguidos = ganador
					//(ok)  mostrar mensajes partialResult y finalResult
					// historial de games ganados / perdidos
					//(ok)  reset para volver a jugar
					//(ok)  		- ocultar boton de flip
					//(ok)  		- resetear contador
					// 		- agregar al hisotrial el reslutado
					//(uso RESET)       - agregar boton de "volver a jugar"
				}
			})
		</script>
	</body>
</html>
